CREATE TABLE CUSTOMER
(CUST_ID INT PRIMARY KEY,
CUST_NAME VARCHAR(20),
CUST_CITY VARCHAR(15),
CUST_STATE VARCHAR(15),
CUST_DOB DATE)


CREATE TABLE INQUIRY
(INQUIRY_ID INT PRIMARY KEY,
INQUIRY_DATE DATE,
INQUIRY_TYPE VARCHAR(20),
INQUIRY VARCHAR(20),
EMP_ID INT,
CUST_ID INT)

CREATE TABLE EMPLOYEE
(EMP_ID INT PRIMARY KEY,
EMP_NAME VARCHAR(20),
EMP_DOJ DATE,
EMP_CITY VARCHAR(20),
EMP_STATE VARCHAR(20),
MGR_ID INT)

INSERT INTO EMPLOYEE(EMP_ID, EMP_NAME, EMP_DOJ, EMP_CITY, EMP_STATE, MGR_ID) 
VALUES(3400, 'SUMA', '2009-01-10', 'BANGLORE', 'KA', 3401);

INSERT INTO EMPLOYEE(EMP_ID, EMP_NAME, EMP_DOJ, EMP_CITY, EMP_STATE) 
VALUES(3401, 'SURAJ', '2013-04-10', 'BANGLORE', 'KA');

INSERT INTO EMPLOYEE(EMP_ID, EMP_NAME, EMP_DOJ, EMP_CITY, EMP_STATE, MGR_ID) 
VALUES(3402, 'RAJESH', '2018-05-11', 'CHENNAI', 'TN', 3401);

INSERT INTO EMPLOYEE(EMP_ID, EMP_NAME, EMP_DOJ, EMP_CITY, EMP_STATE) 
VALUES(3403, 'ADITYA', '2009-01-10', 'CHENNAI', 'TN');

INSERT INTO EMPLOYEE(EMP_ID, EMP_NAME, EMP_DOJ, EMP_CITY, EMP_STATE, MGR_ID) 
VALUES(2400, 'RAGHAVAN', '2009-01-10', 'BANGLORE', 'KA', 3400);

INSERT INTO EMPLOYEE(EMP_ID, EMP_NAME, EMP_DOJ, EMP_CITY, EMP_STATE, MGR_ID) 
VALUES(3405, 'VISWANATH', '2009-01-10', 'MUMBAI', 'MH', 3400);

INSERT INTO EMPLOYEE(EMP_ID, EMP_NAME, EMP_DOJ, EMP_CITY, EMP_STATE, MGR_ID) 
VALUES(3455, 'DHRUV', '2009-01-10', 'MUMBAI', 'MH', 3400);

DROP TABLE INQUIRY

ALTER TABLE INQUIRY
ADD CONSTRAINT FK_CUSTID
FOREIGN KEY(CUST_ID) REFERENCES CUSTOMER(CUST_ID)

ALTER TABLE INQUIRY
ADD CONSTRAINT FK_EMPID
FOREIGN KEY(EMP_ID) REFERENCES EMPLOYEE(EMP_ID)


INSERT INTO CUSTOMER VALUES(100, 'TIM', 'CHENNAI', 'TN', '2000-02-22');
INSERT INTO CUSTOMER VALUES(101, 'BILL', 'BANGLORE', 'KA', '2000-01-04');
INSERT INTO CUSTOMER(CUST_ID, CUST_NAME, CUST_CITY, CUST_STATE) VALUES(102, 'RAVI', 'CHENNAI', 'TN');
INSERT INTO CUSTOMER VALUES(103, 'PALLAVI', 'BANGLOREI', 'KA', '1998-04-10');
INSERT INTO CUSTOMER VALUES(104, 'PRITHVI', 'MUMBAI', 'MH', '1997-10-18');

UPDATE CUSTOMER
SET CUST_CITY = 'BANGLORE' WHERE CUST_ID = 103
SELECT * FROM CUSTOMER

INSERT INTO INQUIRY(INQUIRY_ID, INQUIRY_DATE, INQUIRY_TYPE, INQUIRY, EMP_ID) 
VALUES(1,'2021-08-25', 'INTERNET', 'NEW CONNECTION',3455);

INSERT INTO INQUIRY(INQUIRY_ID, INQUIRY_DATE, INQUIRY_TYPE, INQUIRY, EMP_ID, CUST_ID) 
VALUES(2,'2021-08-25', 'VOICE', 'Upgrade',3455, 101);

INSERT INTO INQUIRY(INQUIRY_ID, INQUIRY_DATE, INQUIRY_TYPE, INQUIRY, EMP_ID, CUST_ID) 
VALUES(3,'2021-08-14', 'INTERNET', 'DATA Upgrade',3400, 102);

INSERT INTO INQUIRY(INQUIRY_ID, INQUIRY_DATE, INQUIRY_TYPE, INQUIRY, EMP_ID, CUST_ID) 
VALUES(4,'2021-08-15', 'INTERNET', 'Line Down Message',3400, 102);

INSERT INTO INQUIRY(INQUIRY_ID, INQUIRY_DATE, INQUIRY_TYPE, INQUIRY, EMP_ID) 
VALUES(5,'2021-08-20', 'VOICE', 'New Connection',3455);

INSERT INTO INQUIRY(INQUIRY_ID, INQUIRY_DATE, INQUIRY_TYPE, INQUIRY, EMP_ID, CUST_ID) 
VALUES(6,'2021-08-21', 'INTERNET', 'Line Down Message',3400, 103);

INSERT INTO INQUIRY(INQUIRY_ID, INQUIRY_DATE, INQUIRY_TYPE, INQUIRY, EMP_ID, CUST_ID) 
VALUES(7,'2021-08-22', 'VOICE', 'Data Upgrade',2400, 102);


SELECT * FROM INQUIRY

SELECT CUST_NAME, CUST_CITY, INQUIRY, EMP_ID
FROM CUSTOMER C FULL OUTER JOIN INQUIRY I
ON C.CUST_ID = I.CUST_ID
WHERE CUST_CITY = 'CHENNAI';

SELECT INQUIRY_TYPE, INQUIRY, EMP_ID, CUST_NAME
FROM INQUIRY I LEFT OUTER JOIN CUSTOMER C
ON C.CUST_ID = I.CUST_ID
WHERE CUST_CITY = 'BANGLORE' OR CUST_CITY IS NULL


SELECT INQUIRY_TYPE, INQUIRY, EMP_ID, CUST_NAME
FROM INQUIRY I INNER JOIN CUSTOMER C
ON C.CUST_ID = I.CUST_ID
WHERE CUST_CITY = 'BANGLORE' OR CUST_CITY IS NULL


SELECT CUST_NAME, INQUIRY 
FROM CUSTOMER C INNER JOIN INQUIRY I 
ON C.CUST_ID=I.CUST_ID 
WHERE CUST_STATE = (SELECT CUST_STATE FROM CUSTOMER 
WHERE CUST_NAME ='PALLAVI' AND INQUIRY_TYPE = 'VOICE')

SELECT EMP_CITY, COUNT(EMP_ID) FROM EMPLOYEE GROUP BY EMP_CITY

SELECT EMP_NAME, INQUIRY_TYPE, INQUIRY, EMP_CITY 
FROM INQUIRY I 
INNER JOIN EMPLOYEE E ON I.EMP_ID= E.EMP_ID
WHERE EMP_CITY = 'BANGLORE' AND MONTH(INQUIRY_DATE)=8

SELECT EMP_NAME FROM EMPLOYEE WHERE MGR_ID IS NOT NULL

SELECT EMP_NAME FROM EMPLOYEE WHERE MGR_ID IN (SELECT MGR_ID  FROM EMPLOYEE)

SELECT EMP_NAME, UPPER(SUBSTR(EMP_CITY,1,3)), EMP_STATE FROM EMPLOYEE E 
INNER JOIN INQUIRY I ON E.EMP_ID=I.EMP_ID WHERE INQUIRY_TYPE='VOICE'

SELECT EMP_NAME, COUNT(INQUIRY_ID) NO_OF_INQUERIES FROM INQUIRY I INNER JOIN EMPLOYEE E 
ON E.EMP_ID=I.EMP_ID WHERE MONTH(INQUIRY_DATE)=8
GROUP BY EMP_NAME HAVING COUNT(INQUIRY_ID) > 2 

SELECT EMP_NAME, MANAGER_NAME FROM EMPLOYEE INNER JOIN
(SELECT  EMP_NAME AS MANAGER_NAME FROM EMPLOYEE 
WHERE MGR_ID IS NULL OR EMP_ID IN (SELECT MGR_ID  FROM EMPLOYEE)TEMP1
ON 

SELECT * FROM CUSTOMER
UNION

SELECT EMP_NAME FROM EMPLOYEE 
WHERE EMP_ID IN (SELECT MGR_ID  FROM EMPLOYEE )

SELECT EMP_CITY, COUNT(EMP_ID) AS NO_OF_EMP FROM EMPLOYEE GROUP BY EMP_CITY HAVING COUNT(EMP_ID) >2

SELECT COUNT(INQUIRY_ID) FROM INQUIRY WHERE CUST_ID IS NULL

SELECT EMP_NAME FROM EMPLOYEE WHERE EMP_STATE = 'MH' AND MONTH(EMP_DOJ) = 1

SELECT CUST_NAME FROM CUSTOMER WHERE CUST_STATE = (SELECT CUST_STATE FROM CUSTOMER 
WHERE CUST_NAME = 'PALLAVI') AND YEAR(CUST_DOB)=2000

SELECT CUST_NAME,CUST_CITY, INQUIRY, EMP_NAME, EMP_CITY FROM CUSTOMER C INNER JOIN INQUIRY I 
ON C.CUST_ID=I.CUST_ID INNER JOIN EMPLOYEE E ON E.EMP_ID = I.EMP_ID WHERE CUST_STATE = 'TN'

SELECT DISTINCT INQUIRY_TYPE FROM INQUIRY

SELECT EMP_NAME FROM EMPLOYEE WHERE EMP_ID NOT IN (SELECT EMP_ID FROM INQUIRY)

SELECT CUST_NAME FROM CUSTOMER WHERE (CUST_NAME LIKE 'R%' OR CUST_NAME LIKE 'P%' ) 
AND YEAR(CUST_DOB) IN (1997, 1998,1999,200)

SELECT CUST_NAME FROM CUSTOMER 
WHERE (CUST_NAME LIKE 'R%' OR CUST_NAME LIKE 'P%' ) 
AND YEAR(CUST_DOB) BETWEEN 1997 AND 2000


CREATE TABLE CUSTOMER1
(CUST_ID INT PRIMARY KEY,
CUST_NAME VARCHAR(20),
CUST_CITY VARCHAR(20),
CUST_STATE VARCHAR(10),
CUST_DOB DATE,
GENDER VARCHAR(5))


INSERT INTO CUSTOMER1 VALUES(100, 'TIM', 'CHENNAI', 'TN', '2000-02-22', 'M');
INSERT INTO CUSTOMER1 VALUES(101, 'BILL', 'BANGLORE', 'KA', '2000-01-04', 'M');
INSERT INTO CUSTOMER1 VALUES(102, 'RAVI', 'CHENNAI', 'TN', '2000-02-22', 'M');
INSERT INTO CUSTOMER1 VALUES(103, 'PALLAVI', 'BANGLORE', 'KA', '1998-04-10', 'F');
INSERT INTO CUSTOMER1 VALUES(104, 'PRITHVI', 'MUMBAI', 'MH', '2000-10-18', 'F');

SELECT * FROM CUSTOMER1

SELECT TEMP1.CUST_STATE, MALE_CUSTOMER_COUNT, FEMALE_CUSTOMER_COUNT FROM
(SELECT CUST_STATE, COUNT(CUST_ID) MALE_CUSTOMER_COUNT 
FROM CUSTOMER1 WHERE GENDER = 'M' GROUP BY CUST_STATE)TEMP1
LEFT OUTER JOIN
(SELECT CUST_STATE, COUNT(CUST_ID) FEMALE_CUSTOMER_COUNT 
FROM CUSTOMER1 WHERE GENDER = 'F' GROUP BY CUST_STATE)TEMP2
ON TEMP1.CUST_STATE=TEMP2.CUST_STATE
 
UNION

SELECT TEMP1.CUST_STATE, MALE_CUSTOMER_COUNT, FEMALE_CUSTOMER_COUNT FROM
(SELECT CUST_STATE, COUNT(CUST_ID) MALE_CUSTOMER_COUNT 
FROM CUSTOMER1 WHERE GENDER = 'M' GROUP BY CUST_STATE)TEMP1
RIGHT OUTER JOIN
(SELECT CUST_STATE, COUNT(CUST_ID) FEMALE_CUSTOMER_COUNT 
FROM CUSTOMER1 WHERE GENDER = 'F' GROUP BY CUST_STATE)TEMP2
ON TEMP1.CUST_STATE=TEMP2.CUST_STATE

--
----------------------------------------------------------------------------

SELECT TEMP1.CUST_STATE, MALE_CUSTOMER_COUNT, FEMALE_CUSTOMER_COUNT FROM
 (SELECT CUST_STATE, COUNT(CUST_ID) MALE_CUSTOMER_COUNT 
FROM CUSTOMER1 WHERE GENDER = 'M' GROUP BY CUST_STATE
UNION 
SELECT DISTINCT(CUST_STATE), 0 AS MALE_CUSTOMER_COUNT  FROM CUSTOMER1
WHERE CUST_STATE NOT IN (SELECT CUST_STATE FROM CUSTOMER1 WHERE GENDER='M'))TEMP1
INNER  JOIN
(SELECT CUST_STATE, COUNT(CUST_ID) FEMALE_CUSTOMER_COUNT 
FROM CUSTOMER1 WHERE GENDER = 'F' GROUP BY CUST_STATE
UNION 
SELECT DISTINCT(CUST_STATE), 0 AS FEMALE_CUSTOMER_COUNT  FROM CUSTOMER1
WHERE CUST_STATE NOT IN (SELECT CUST_STATE FROM CUSTOMER1 WHERE GENDER='F'))TEMP2
ON TEMP1.CUST_STATE=TEMP2.CUST_STATE
------------------------------------------------------------------------
SELECT * FROM EMPLOYEE
SELECT EMP.EMP_NAME, MGR.EMP_NAME 
FROM EMPLOYEE EMP INNER JOIN EMPLOYEE MGR
ON EMP.MGR_ID = MGR.EMP_ID

